---
- name: Set up Ubuntu 22.04
  hosts: localhost
  become: true
  gather_facts: false

  vars_files:
    - defaults/main.yml

  pre_tasks:
    - name: Perform system updates
      ansible.builtin.apt:
        update_cache: true
        upgrade: dist
      notify:
        - Remove obsolete apt dependencies
    - name: Ensure handlers are notified now
      ansible.builtin.meta: flush_handlers

  roles:
    - role: docker
      vars:
        docker_user: "{{ user }}"
      tags: ["docker"]
    - role: devops_tools
      tags: ["devops_tools"]

  tasks:
    - name: Import utils task
      ansible.builtin.import_tasks: tasks/utils.yml
      tags: ["utils"]
    - name: Import ZSH task
      ansible.builtin.import_tasks: tasks/zsh.yml
      tags: ["zsh"]
    - name: Import customizations task
      ansible.builtin.import_tasks: tasks/customizations.yml
      tags: ["customizations"]
